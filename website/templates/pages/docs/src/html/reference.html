<h1 id="reference">Reference</h1>
<p>This document goes through the command-line tools, describing how to perform specific tasks such as creating a storage network, contributing storage capacity, inviting users to join a drive and more.</p>
<h2 id="introduction">Introduction</h2>
<h3 id="terminology">Terminology</h3>
<p>The Infinit command-line tools are composed of several binaries, each dealing with a specific resource/object.</p>
<p>A <em>user</em> represents the entity performing operations on files, directly or indirectly. Every user possesses a RSA key pair that is used to identify him/her. A user can create a <em>network</em> which represents the interconnection of computing devices that will compose the storage infrastructure. A <em>storage</em> is a storage resource, local or remote, that can be connected to a device to support part of the overall storage load. Finally, several <em>volume</em>s&nbsp;&#8209;&#8209;- i.e logical drives&nbsp;&#8209;&#8209;-  can be created within a network.</p>
<p>The <em>hub</em> is a cloud service whose role is to ease the process of discovery, sharing and more.</p>
<h3 id="home">Home</h3>
<p>All the configuration files Infinit creates and uses are located in the <code>$INFINIT_HOME</code> directory which, by default, is set to <code>$HOME/.local/share/infinit/filesystem/</code>.</p>
<p>One can very easily set the environment variable to point to the directory of his/her choice, either by modifying the shell configuration or by setting it manually:</p>
<pre><code>$&gt; export INFINIT_HOME="/some/where/"
</code></pre><h3 id="nomenclature">Nomenclature</h3>
<p>All the command-line tools rely on the same terminology when it comes to options and arguments. As an example, most binaries have options named <code>&#8209;&#8209;create</code>, <code>&#8209;&#8209;list</code>, <code>&#8209;&#8209;fetch</code> etc.</p>
<p>For more information on the options provided by a binary, do not hesitate to rely on the <code>&#8209;&#8209;help</code> option. Noteworthy is that the help is relative to the options already provided.</p>
<p>As an example, the help for <em>infinit-user</em> displays the general options available: export, create, import, list etc.:</p>
<pre><code>$&gt; Usage: infinit-user MODE [OPTIONS...]

Infinit user utility:

Modes:
 &nbsp;&#8209;&#8209;create               Create a user
 &nbsp;&#8209;&#8209;export               Export a user so that it may be imported elsewhere
 &nbsp;&#8209;&#8209;fetch                Fetch a user from the Hub
 &nbsp;&#8209;&#8209;import               Import a user
 &nbsp;&#8209;&#8209;pull                 Remove a user from the Hub
 &nbsp;&#8209;&#8209;delete               Delete a user locally
 &nbsp;&#8209;&#8209;push                 Push a user to the Hub
 &nbsp;&#8209;&#8209;signup               Create and register a user
 &nbsp;&#8209;&#8209;login                Log the user to the Hub
 &nbsp;&#8209;&#8209;list                 List users

Miscellaneous:
  -h [&nbsp;&#8209;&#8209;help ]          display the help
  -s [&nbsp;&#8209;&#8209;script ]        silence all extraneous human friendly messages
  -v [&nbsp;&#8209;&#8209;version ]       display version
</code></pre><p>However, the help when invoking the <code>&#8209;&#8209;create</code> option gives a completely different output:</p>
<pre><code>$&gt; Usage: infinit-user&nbsp;&#8209;&#8209;create [OPTIONS...]

Create a user:

Create options:
  -n [&nbsp;&#8209;&#8209;name ] arg      user name (default: system user)
  -k [&nbsp;&#8209;&#8209;key ] arg       RSA key pair in PEM format - e.g. your SSH key
                         (default: generate key pair)
 &nbsp;&#8209;&#8209;push-user            push the user to the Hub
  -p [&nbsp;&#8209;&#8209;push ]          alias for&nbsp;&#8209;&#8209;push-user
 &nbsp;&#8209;&#8209;email arg            valid email address (mandatory when using&nbsp;&#8209;&#8209;push-user)
 &nbsp;&#8209;&#8209;fullname arg         user fullname (optional)
 &nbsp;&#8209;&#8209;full                 include private key in order to facilitate device
                         pairing and fetching lost keys.
 &nbsp;&#8209;&#8209;password arg  password to authenticate with the Hub. Used with
                        &nbsp;&#8209;&#8209;full (default: prompt for password)
</code></pre><p>Every binary follows the same semantic with the first option representing the mode of operation (a verb): <code>&#8209;&#8209;create</code>, <code>&#8209;&#8209;pull</code>, <code>&#8209;&#8209;list</code>, <code>&#8209;&#8209;delete</code>, <code>&#8209;&#8209;export</code> etc.</p>
<p>The name/identifier of the object on which you which to operate can be specified through the <code>&#8209;&#8209;name</code> option or simply by providing it outside of any option. As such both lines below are equivalent:</p>
<pre><code>$&gt; infinit-volume&nbsp;&#8209;&#8209;push&nbsp;&#8209;&#8209;name personal
$&gt; infinit-volume&nbsp;&#8209;&#8209;push personal
</code></pre><p>Except for the <em>infinit-user</em> binary, one can specify the Infinit user behind the action by relying on the <code>&#8209;&#8209;as</code> option followed by the user name. If not specified, the <code>$INFINIT_USER</code> environment variable is used, unless not set in which case the system user name is used.</p>
<p>Finally, some command-line tools, in particular <em>infinit-network</em>, and <em>infinit-volume</em> can be "run". As such, they have options such as <code>&#8209;&#8209;start</code>, <code>&#8209;&#8209;stop</code>, <code>&#8209;&#8209;status</code> etc. in order to allow developers to manipulate them in a similar fashion to other UNIX daemons e.g init scripts.</p>
<h3 id="hub">Hub</h3>
<p>All objects (users, storages, networks, volumes etc.) are created locally by default with no server involved. The creation process may generate one or more files and store them in the <code>$INFINIT_HOME</code> directory.</p>
<p>The command-line tools however provide a way to rely on the hub for certain operations in order to simplify some administrative tasks such as inviting a user to a drive, sharing the volumes created within a network, moving the user identity to another of your devices and so on. In addition, some functionalities such as the consumption of storage capacity in a network are only available through the hub. As a rule of thumb, we advise you to always rely on the hub, unless you know exactly what you are doing.</p>
<p>The use of the hub can be activated through specific options, mostly <code>&#8209;&#8209;push</code>, <code>&#8209;&#8209;fetch</code> and <code>&#8209;&#8209;pull</code>. The <code>&#8209;&#8209;push</code> option publishes an object on the hub for other users to retrieve it. The <code>&#8209;&#8209;pull</code> option does the exact opposite, removing the object from the hub. Finally, the <code>&#8209;&#8209;fetch</code> option retrieves a resource from the hub, e.g a network descriptor, and stores it locally in the <code>$INFINIT_HOME</code> directory.</p>
<p>One can decide to either create objects locally before pushing them to the hub or to perform both tasks through a single action by specifying <code>&#8209;&#8209;push</code> option when invoking the command.</p>
<p>Note that some binaries operate in hub mode by default. For instance the <em>infinit-drive</em> binary would not make sense without the hub since its role is to bridge the gap between a low-level storage infrastructure and potential non-tech-savvy users.</p>
<p><strong>IMPORTANT</strong>: This document covers mainly flows involving the hub. For users wanting to use Infinit in a pure decentralized environment, just know that <code>&#8209;&#8209;push</code>/<code>&#8209;&#8209;fetch</code> operations must be replaced by <code>&#8209;&#8209;export</code>/<code>&#8209;&#8209;import</code> operations while the files must be manually shared with other users and moved between devices. Also, you will sometimes need to provide additional information such as the IP address of bootstrap nodes in order to discover the other nodes of a network.</p>
<h2 id="user">User</h2>
<p>The <em>infinit-user</em> binary allows one to create a user identity, publish it on the hub to be referenced by other users and so on and so forth.</p>
<h3 id="create-a-user">Create a user</h3>
<p>A user is not much more than a RSA key pair that will be used to sign and encrypt data. The following creates a user, automatically generating a new RSA key pair.</p>
<p>Note that the name of the user is deduced from the system if you do not specify a name through the <code>&#8209;&#8209;name</code> option or the <code>$INFINIT_USER</code> environment variable.</p>
<pre><code>$&gt; echo $USER
alice
$&gt; infinit-user&nbsp;&#8209;&#8209;create
Generating RSA keypair.
Locally generated user "alice".
</code></pre><p>You may want to specify the RSA key pair to use rather than generating a new one. You can use the <code>&#8209;&#8209;key</code> option to reference a PEM-formatted RSA private key (e.g your SSH RSA key) and Infinit will create a user identity based on it.</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;name alice&nbsp;&#8209;&#8209;key ~/.ssh/id_rsa
Passphrase: ********
Locally generated user "alice".
</code></pre><p><em><strong>WARNING</strong>: Keep in mind that your Infinit user identity must never fall into someone else’s hands. The user identity file is the equivalent of an SSH key file and must therefore be kept private at all times.</em></p>
<h3 id="sign-up-on-the-hub">Sign up on the hub</h3>
<p>To register on the hub, you can either use the <code>&#8209;&#8209;push</code> option when creating your user, push the user once it has been created locally or sign up directly on the hub.</p>
<p>To push an existing user, simply invoke the <em>infinit-user</em> with the <code>&#8209;&#8209;push</code> mode and <code>&#8209;&#8209;email</code> option to specify a valid email address. Needless to say that this email address will <em>never</em> be shared with third parties and will solely be used for Infinit to communicate news of its file storage platform.</p>
<p><strong>IMPORTANT</strong>: Given the critical nature of the user identity, we strongly advise you to read the <a href="#log-in-on-another-device">Log in on another device</a> section in order to completely understand the ramifications of the options used when pushing your user.</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;push&nbsp;&#8209;&#8209;name alice&nbsp;&#8209;&#8209;fullname "Alice"&nbsp;&#8209;&#8209;email alice@company.com
Remotely pushed user "alice".
</code></pre><p>Unfortunately, since names are unique, your user name may already be taken on the hub, in which case the operation will fail. The action <code>&#8209;&#8209;signup</code> has been introduced to overcome this problem, performing the equivalent of <code>&#8209;&#8209;create&nbsp;&#8209;&#8209;push</code> atomically, making sure that the user is created locally and remotely at once.</p>
<p>We advise users to sign up to the hub very early on in order to avoid future complications:</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;signup&nbsp;&#8209;&#8209;name alice&nbsp;&#8209;&#8209;fullname "Alice"&nbsp;&#8209;&#8209;email alice@company.com
Generating RSA keypair.
Remotely pushed user "alice".
</code></pre><h3 id="fetch-a-user">Fetch a user</h3>
<p>One can very easily fetch the public identity of another user through the <code>&#8209;&#8209;fetch</code> mode:</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;name bob
Fetched user "bob".
</code></pre><h3 id="list-users">List users</h3>
<p>The list of users kept locally can contain both user identities that you created and therefore own but also public identities of users that you fetched from the Hub for instance.</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;list
alice: public/private keys
bob: public key only
</code></pre><h2 id="credentials">Credentials</h2>
<p>The <em>infinit-credentials</em> binary manages the credentials to your cloud services. Indeed, cloud services can be added to be later plugged to a network as storage resources.</p>
<p>The cloud services can be of very different nature, being storage service at the block level such as the AWS S3 object store service, at the file level such as Dropbox or Google Drive, even services that store data item of a specific nature such as images with Flickr. Basically anything that allows writing, editing, finding and deleting a piece of information.</p>
<p>Infinit considers these cloud services as basic and unprivileged datastores that are used to store blocks of encrypted data.</p>
<p><em><strong>NOTE</strong>: Because this binary exclusively works with the hub, you must have registered your user to the Infinit hub to be able to manage your credentials. For more information, please refer to the <a href="#user">User</a> section, more specifically how to <a href="#sign-up-on-the-hub">Sign up on the hub</a>.</em></p>
<h3 id="add-credentials">Add credentials</h3>
<p>To add a cloud service such as Dropbox, just use the <code>&#8209;&#8209;add</code> action option. Note however that depending on the cloud service to add, the options may vary along with the authentication process. Please refer to the help for more information.</p>
<pre><code>$&gt; infinit-credentials&nbsp;&#8209;&#8209;add&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;dropbox
Register your Dropbox account with Infinit by visiting https://…
$&gt;
</code></pre><p>Just follow the instructions by visiting the URL provided in order to authenticate yourself and authorize Infinit to access your account. At this point, you should be automatically redirected to the infinit.sh website.</p>
<p><em><strong>NOTE</strong>: Do not worry, Infinit will never alter the existing data items stored in your cloud services; it will only create blocks of encrypted data in a subfolder specific to Infinit.</em></p>
<p>Once a cloud service added to your account, you can fetch the new credentials on your device through the <code>&#8209;&#8209;fetch</code> option:</p>
<pre><code>$&gt; infinit-credentials&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice
Fetched Dropbox credentials 51218344 (Alice)
Fetched AWS S3 credentials alice@company.com (Alice)
</code></pre><h3 id="list-credentials">List credentials</h3>
<p>At any point, you can list your local credentials through the <code>&#8209;&#8209;list</code> option.</p>
<p>Note that this list may be outdated, in which case you may want to update it by fetching the most recent credentials from the hub:</p>
<pre><code>$&gt; infinit-credentials&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice
$&gt; infinit-credentials&nbsp;&#8209;&#8209;list
Dropbox:
  51218344 (Alice)
AWS S3:
  alice@company.com (Alice)
</code></pre><h2 id="storage">Storage</h2>
<p>The <em>infinit-storage</em> binary allows for the definition of storage resources. Such storage resources can be local — storing blocks of data on the local file system, on a partition or in a database — or remote in which case the blocks of data are stored through a cloud service API.</p>
<p>Noteworthy is the storage resources are device-specific. As such, such resources cannot be pushed to the hub since they only live locally.</p>
<h3 id="create-a-storage-resource">Create a storage resource</h3>
<h4 id="locally">Locally</h4>
<p>To create a storage resource on top of a local file system, simply specify the <code>&#8209;&#8209;filesystem</code> option. Note that you can also specify, through the <code>&#8209;&#8209;path</code> option, where the encrypted data blocks will be stored.</p>
<pre><code>$&gt; infinit-storage&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;filesystem&nbsp;&#8209;&#8209;capacity 2GB&nbsp;&#8209;&#8209;name local
Created storage "local".
</code></pre><h4 id="remotely">Remotely</h4>
<p>You can create a storage on top of a cloud service API. Obviously, you will need to add this cloud service through the <em>infinit-credentials</em> first, as shown in the <a href="#add-credentials">Add credentials</a> section.</p>
<p>All you need to do then is specify the type of cloud service you want your storage to rely upon along with the cloud service account identifier. Cloud service identifiers can be retrieved when <a href="#list-credentials">listing your credentials</a>.</p>
<p>The following creates a storage resource on top of Dropbox, specifying the account identifier and a name for the storage:</p>
<pre><code>$&gt; infinit-storage&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;dropbox&nbsp;&#8209;&#8209;account 51218344&nbsp;&#8209;&#8209;name dropbox
Created storage "dropbox".
</code></pre><p>Note that the list of supported cloud services can be retrieved through the <code>&#8209;&#8209;create&nbsp;&#8209;&#8209;help</code> options. In the future, more of those will be supported, from <a href="https://aws.amazon.com/s3">AWS S3</a>, <a href="https://cloud.google.com/storage">Google Cloud Storage</a>, <a href="https://www.backblaze.com/b2">Backblaze B2</a> and many more.</p>
<h2 id="network">Network</h2>
<p>Through the <em>infinit-network</em> you are going to be able to create overlay networks, configure the the way the distributed hash table behaves and much more.</p>
<h3 id="create-a-network">Create a network</h3>
<p>The example below creates a network named <em>‘cluster’</em> which aggregates the storage resources controlled by the users involved in this network.</p>
<p>The network can be configured depending on the requirements of the storage infrastructure the administrator is setting up. For instance, the number of computing devices could be extremely small, the owners of those computers could be somewhat untrustworthy or the machines could be expected to be turned off and on on a daily basis following their work schedule. All these parameters can be used to tune the network: the overlay’s topology, the replication factor, the fault tolerance algorithm and much more.</p>
<p>The following creates a small storage network, relying on the Kelips overlay network with a replication factor of 3. In addition, the administrator decides to contribute two storage resources to the network in creation.</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;kelips&nbsp;&#8209;&#8209;k 1&nbsp;&#8209;&#8209;replication-factor 3&nbsp;&#8209;&#8209;storage local&nbsp;&#8209;&#8209;storage dropbox&nbsp;&#8209;&#8209;name cluster
Locally created network "alice/cluster".
</code></pre><h3 id="publish-a-network">Publish a network</h3>
<p>You can now publish a network for other users to retrieve it. Note that the easiest way is always to append the <code>&#8209;&#8209;push</code> option to the network creation command to perform both creation and publications actions at once.</p>
<p>Otherwise, you can push the network to the hub through the <code>&#8209;&#8209;push</code> action option, as usual:</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;push&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name cluster
Remotely pushed network "alice/cluster".
</code></pre><p>As for every other resource, you can decide to manipulate networks without relying on the hub. Please refer to the <code>&#8209;&#8209;export</code> and <code>&#8209;&#8209;import</code> options in this case.</p>
<h3 id="list-the-networks">List the networks</h3>
<p>You can easily list the networks that you have locally through the <code>&#8209;&#8209;list</code> mode. Do not forget that you may need to fetch the networks from the hub in order to be in sync:</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice
Fetched networks for user "alice".
$&gt; infinit-network&nbsp;&#8209;&#8209;list
alice/cluster
</code></pre><h3 id="join-a-network">Join a network</h3>
<p>Let us say that you want to connect a device to a network, this device being different from the one on which the network has been created.</p>
<p>There are two ways to do this depending on who you are related to the network: its owner or an invited user.</p>
<h4 id="as-the-owner">As the owner</h4>
<p>As the owner of the network, the system automatically recognizes you and allows you to join the network on other devices. The process in this case is pretty straightforward.</p>
<p>Note however that when joining a network, you can decide to contribute storage from this new device. In the example below, Alice is going to connect one of her other devices, taking care to contribute storage capacity from her personal Network-Attached Storage (NAS).</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;join&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name cluster&nbsp;&#8209;&#8209;storage nas
Locally joined network "cluster".
</code></pre><p>_<strong>NOTE</strong>: Keep in mind that the action of joining a network must be performed on every new device.</p>
<h4 id="as-an-invitee">As an invitee</h4>
<p>In this case, you should have <a href="#receive-a-passport">received</a>, through the hub or manually, an invitation to join a network created by someone else. Such invitations are called <em>passports</em> and allow users to connect their devices to the network they’ve been allowed to join.</p>
<p>In order to join a network, you must first retrieve its descriptor. This network descriptor can be fetched from the hub through a single command:</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as bob&nbsp;&#8209;&#8209;name alice/cluster
Fetched network "alice/cluster".
</code></pre><p>You now have locally both the network descriptor and a passport allowing you to connect new devices to it. Let’s join Alice’s ‘cluster’ network with Bob’s current device. Note that one can decide to contribute additional storage capacity through the <code>&#8209;&#8209;storage</code> option.</p>
<pre><code>$&gt; infinit-network&nbsp;&#8209;&#8209;join&nbsp;&#8209;&#8209;as bob&nbsp;&#8209;&#8209;name alice/cluster
Locally joined network "alice/cluster".
</code></pre><p>_<strong>NOTE</strong>: This process must be repeated on every device, proving that Bob has indeed been allowed to join the network (via the passport) and that this device belongs to Bob.</p>
<h2 id="passport">Passport</h2>
<p>The <em>infinit-passport</em> binary can be used to allow other users to join one’s networks, granting them the right to connect devices, contribute storage resources and potentially access files.</p>
<h3 id="create-a-passport">Create a passport</h3>
<p>In order to allow another user to join a network, you must issue a passport. In order to reference the user to invite, you first need to obtain his/her user public identity.</p>
<p>Let’s say that you want to invite the user ‘bob’ to your network. First you need to fetch his identity from the hub (or retrieve it manually if operating without the hub, see <code>&#8209;&#8209;export</code> and <code>&#8209;&#8209;import</code>):</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name bob
Fetched user "bob".
</code></pre><p>The passport that you are about to create will be sealed, allowing only Bob to <a href="#join-a-network">connect new devices</a> to the network:</p>
<pre><code>$&gt; infinit-passport&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;network cluster&nbsp;&#8209;&#8209;user bob
Locally created passport "alice/cluster: bob".
</code></pre><p>Now that the passport has been created, read the <a href="#distribute-a-passport">Distribute a passport</a> section to learn how to distribute it to the invited user.</p>
<h3 id="list-the-passports">List the passports</h3>
<p>You can list both the passports you’ve created for other users to join your networks and the passports issued by other users for you to join their networks:</p>
<pre><code>$&gt; infinit-passport&nbsp;&#8209;&#8209;list&nbsp;&#8209;&#8209;as alice
alice/cluster: bob
</code></pre><h3 id="distribute-a-passport">Distribute a passport</h3>
<p>Once the passport locally created, you must distribute it to the invited user for him/her to be able to join your network.</p>
<p>The easiest way to do that is to rely on the hub, by appending the <code>&#8209;&#8209;push</code> option when creating the passport; see the <a href="#create-a-passport">Create a passport</a> section.</p>
<p>You can otherwise push a local passport by invoking the <code>&#8209;&#8209;push</code> action option as shown below:</p>
<pre><code>$&gt; infinit-passport&nbsp;&#8209;&#8209;push&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;network cluster&nbsp;&#8209;&#8209;user bob
Remotely pushed passport "alice/cluster: bob".
</code></pre><p>Should you be evolving in a pure decentralized environment i.e without the hub, you will need to manually export the passport and transmit it to the invited user in which case you should refer to the <code>&#8209;&#8209;export</code> and <code>&#8209;&#8209;import</code> options.</p>
<p><strong>IMPORTANT</strong>: Be aware that the invited user will not be notified of that fact that you’ve allowed him/her to join your network. The invited user could detect it by fetching his passport and noticing a new one but that’s about it. In order to speed things up, you should probably tell him through the medium of your choice: chat, email, carrier pigeon or else.</p>
<h3 id="receive-a-passport">Receive a passport</h3>
<p>You can very easily fetch your passports from the hub in order to refresh your local snapshots:</p>
<pre><code>$&gt; infinit-passport&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as bob
Fetched passports for user "bob"
$&gt; infinit-passport&nbsp;&#8209;&#8209;list&nbsp;&#8209;&#8209;as bob
alice/cluster: bob
</code></pre><p><em><strong>NOTE</strong>: The <em>infinit-passport</em> binary provides options to specifically fetch passports from a certain user or for a specific network.</em></p>
<p>That’s it, you will now be able to <a href="#join-a-network">join the networks</a> these passports allow you to.</p>
<h2 id="volume">Volume</h2>
<p>On top of the storage layer i.e the network, one can create a file system also known as logical drive or volume. A volume is represented by the address of its root directory. While centralized file systems store this address in a specific block known as the <em>superblock</em>, Infinit simply stores it in a file located in the <code>$INFINIT_HOME</code> directory which describes the volume.</p>
<p>Note that several volumes can be created within the same network, in which case you could see those as partitions on the same hard disk drive.</p>
<h3 id="create-a-volume">Create a volume</h3>
<p>The command below creates a volume in a network. You can specify the default mount point for the volume through the <code>&#8209;&#8209;mountpoint</code> option even though the following example does not:</p>
<pre><code>$&gt; infinit-volume&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;network cluster&nbsp;&#8209;&#8209;name shared
Locally created volume "alice/shared".
</code></pre><p><em><strong>NOTE</strong>: You may have noticed that the name of the network is sometimes prepended with the username of its owner e.g alice/cluster. This fully-qualified name helps distinguish objects that you own from the ones that you don’t. However, in most cases, you will not have to specify the fully-qualified name as the command-line tools are smart enough to deduce the object you are trying to reference.</em></p>
<h3 id="publish-a-volume">Publish a volume</h3>
<p>A volume often needs to be shared with the other users in the network. As for the other resources, the easiest way to perform this action is to rely on the hub, either by using the <code>&#8209;&#8209;push</code> option at the volume creation or by publishing the volume as a separate action:</p>
<pre><code>$&gt; infinit-volume&nbsp;&#8209;&#8209;push&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name shared
Remotely pushed volume "alice/shared".
</code></pre><p><em><strong>NOTE</strong>: You may however want to keep your volume private in a network which several users contribute storage capacity to, in which case you could omit this step.</em></p>
<h3 id="list-the-volumes">List the volumes</h3>
<p>You can very easily list the volumes that you have locally through the <code>&#8209;&#8209;list</code> mode. Remember that you can also fetch the volumes of your networks and the ones you’ve been invited to:</p>
<pre><code>$&gt; infinit-volume&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice
Fetched volumes for user "alice".
$&gt; infinit-volume&nbsp;&#8209;&#8209;list
alice/shared: network alice/cluster
</code></pre><h3 id="mount-a-volume">Mount a volume</h3>
<p>Mounting an Infinit volume is very similar to mounting any other file system. As usual, there are two ways to achieve this, either by relying on the hub as a helper or to do it manually in which case you will need to specify the host and port of some bootstrap nodes for your device to discover the nodes in the network.</p>
<p>Note that if you have been invited to join the network, you will need to fetch the volume before being able to mount it. Refer to the <a href="#list-the-volumes">List the volumes</a> section in this case.</p>
<p>The following command mounts an Infinit file system. Note that the <code>&#8209;&#8209;publish</code> option tells the binary to rely on the hub to ease the process of connecting to the underlying network by providing you with the endpoint of bootstrap nodes while publishing your own endpoint for other nodes to find you as well:</p>
<pre><code>$&gt; infinit-volume&nbsp;&#8209;&#8209;mount&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name shared&nbsp;&#8209;&#8209;mountpoint /mnt/shared/&nbsp;&#8209;&#8209;publish
Fetched endpoints for "alice/cluster".
Running network "alice/cluster".
Remotely pushed endpoints for "alice/cluster".
Running volume "alice/shared".
...
</code></pre><p>The <code>&#8209;&#8209;mountpoint</code> option could be omitted should a default mount point had been provided at the volume creation.</p>
<p><em><strong>NOTE</strong>: There are a number of options that can be used to alter the behavior of the file system such as determining the size of the cache, activating asynchronous operations for better performance and many more. Please invoke the <code>&#8209;&#8209;help</code> option to learn more.</em></p>
<p>If evolving in a completely decentralized environment, you will need to rely on the <code>&#8209;&#8209;peer</code> option to provide the binary one or more bootstrap nodes to discover the underlying network.</p>
<p>At this point, one can interact with the file system through common UNIX built-ins and binaries as for any other file system:</p>
<pre><code>$&gt; ls /mnt/shared/
$&gt; echo "everything is" &gt; /mnt/shared/awesome.txt
$&gt; cat /mnt/shared/awesome.txt
everything is
</code></pre><p><strong>IMPORTANT</strong>: It is possible that the volume owner didn’t grant you access to the root directory, in which case you should get a "Permission Denied" error when listing the mount point. In this case, request the volume owner to <a href="#grant-revoke-access">grant you access</a>.</p>
<h2 id="access-control-list">Access Control List</h2>
<p>Having joined a volume does not necessarily mean that you will have the permission to browse the files and directories in it. As in most file system, in order to access, edit and even delete a file, its owner must first grant you the permission to do so.</p>
<p>Unlike many file systems, Infinit provides advanced decentralized (i.e without relying on a centralized server) access control mechanisms that allow any user to manage permissions on his/her files and directories.</p>
<p>Note that being the owner of a volume automatically grants you access to its root directory. It is then your responsibility to manage the permissions on the root directory for other users to use the volume.</p>
<h3 id="grant-revoke-access">Grant/revoke access</h3>
<p>In order to grant or revoke access to a file or directory, one simply has to rely on the <em>infinit-acl</em> binary, providing the path to the object to manage and the permissions to apply.</p>
<p>The following grants Bob the permissions to read and write the root directory of Alice’s volume named ‘shared’.</p>
<pre><code>$&gt; infinit-acl&nbsp;&#8209;&#8209;set&nbsp;&#8209;&#8209;path /mnt/shared/&nbsp;&#8209;&#8209;mode rw&nbsp;&#8209;&#8209;user bob
</code></pre><p><strong><em>NOTE</em>: Note that the <em>infinit-acl</em> binary provides additional options to better manage hierarchical permissions. Do not hesitate to rely on the help to learn more.</strong></p>
<p>From that point, Bob will be able to access the volume to read and write files/directories in the root directory of Alice&#39;s &#39;shared&#39; volume.</p>
<h3 id="list-permissions">List permissions</h3>
<p>Every user with the volume descriptor and the right permissions can very easily consult the Access Control List (ACL) associated with a file system object:</p>
<pre><code>$&gt; infinit-acl&nbsp;&#8209;&#8209;list&nbsp;&#8209;&#8209;path /mnt/shared/awesome.txt
/mnt/shared/awesome.txt:
     alice: rw
     bob: r
</code></pre><h2 id="device">Device</h2>
<h3 id="log-in-on-another-device">Log in on another device</h3>
<p>You may want to access your file systems from another machine. Even though it sounds easy, the critical nature of the user’s identity, similar to a SSH key, makes it a bit more complicated that all the other operations.</p>
<p>In a nutshell, one needs to re-create his/her Infinit environment with all the resources (users, networks, volumes, drives etc.) on the other computer. If you are already using Infinit in a completely decentralized manner, then the operation of exporting all the objects manually and re-importing them on the other device should not frighten you. If you have gotten used to the ease-of-use of the hub, then we offer you two methods to transmit your user identity on another device.</p>
<p>Note that the preferred method when using the command-line tools should be to <a href="#transmit-user-identity-to-another-device">transmit the user identity</a> to another device.</p>
<h4 id="keep-the-user-identity">Keep the user identity</h4>
<p>The easiest (least secure) way to retrieve your user identity on another device is to activate a mode in which your private identity is kept on the hub, encrypted with a key to protect it from potential intruders.</p>
<p>To activate this mode, you need to specify the <code>&#8209;&#8209;full</code> option when signing up on the hub, along with a password, as shown below. Note that the password can be provided through the <code>&#8209;&#8209;password</code> option or entered when prompted:</p>
<pre>
<div><span>Device A</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;signup&nbsp;&#8209;&#8209;name alice&nbsp;&#8209;&#8209;email alice@company.com&nbsp;&#8209;&#8209;fullname Alice &#8211;&#8211;full
Password: ********
Remotely pushed user "alice".
</code>
</pre>

<p>Following this operation, one can login on another device very simply by invoking the <code>&#8209;&#8209;login</code> option:</p>
<pre class="alternate">
<div><span>Device B</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;login&nbsp;&#8209;&#8209;name alice
Password: ********
Locally saved user "alice".
</code>
</pre>

<p>That’s it, you can see by listing the local users that your private user identity has been retrieved:</p>
<pre class="alternate">
<div><span>Device B</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;list
alice: public/private keys
</code>
</pre>

<p><em><strong>NOTE</strong>: If you already registered your user on the hub but would like to activate this login mode, you can remove your user from the hub through the <code>&#8209;&#8209;pull</code> option and then re-<code>&#8209;&#8209;push</code> it taking care to provide the <code>&#8209;&#8209;full</code> option along with a password.</em></p>
<h4 id="transmit-user-identity-to-another-device">Transmit user identity to another device</h4>
<p>If you are uncomfortable with us keeping your user identity (we are! you should!), there is another (preferred) way for you to just transmit your user identity to another machine.</p>
<p>Just know that for now, the method does rely on the hub as a temporary place for your user identity to be kept until it is retrieved on another device. Do not worry though, if not retrieved after 5 minutes, it will be removed from the hub. Besides, your user identity is encrypted with a key of your choice so we cannot access it. In the future, a direct point-to-point method will be used to bypass the hub altogether.</p>
<pre>
<div><span>Device A</span></div>
<code>$> infinit-device&nbsp;&#8209;&#8209;transmit&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;user
Passphrase: ********
Transmitted user identity for "alice".
</code>
</pre>

<p>From that point, you have 5 minutes to retrieve the user identity on another device through the following command:</p>
<pre class="alternate">
<div><span>Device B</span></div>
<code>$> infinit-device&nbsp;&#8209;&#8209;receive&nbsp;&#8209;&#8209;user&nbsp;&#8209;&#8209;name alice
Passphrase: ********
Received user identity for "alice".
</code>
</pre>

<p>You can verify that the user has been saved locally by listing the local users:</p>
<pre class="alternate">
<div><span>Device B</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;list
alice: public/private keys
</code>
</pre>

<p>Once retrieved, the user identity is wiped out from the hub to make sure nobody can try anything. Even though this method is not ideal yet, it is a fair compromise between security (short window of attack, encrypted with a unique key of your choosing etc.) and simplicity (two commands to invoke, no file to manually move around etc.).</p>
<h4 id="manually-export-import-the-user-identity">Manually export/import the user identity</h4>
<p>For users that either do not trust any of the two methods above or want to evolve in a completely decentralized environment, there is another method which consists in exporting, moving the file manually and finally re-importing the user identity on the new device.</p>
<p>First, export the user identity to a file:</p>
<pre>
<div><span>Device A</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;export&nbsp;&#8209;&#8209;name alice&nbsp;&#8209;&#8209;full&nbsp;&#8209;&#8209;output alice.user
WARNING: you are exporting the user "alice" including the private key
WARNING: anyone in possession of this information can impersonate that user
WARNING: if you mean to export your user for someone else, remove the&nbsp;&#8209;&#8209;full flag
Exported user "alice".
$> cat alice.user
{"email":"alice@company.com","fullname":"Alice","id":"2J8reEAY","name":"alice","private_key":{"rsa":"MIIEp...M/w=="},"public_key":{"rsa":"MIIBC...DAQAB"}}
</code>
</pre>

<p>At this point, it is your responsibility to move the file to your other device, through <em>SCP</em> for instance. Re-creating the user entity is then just one step away:</p>
<pre class="alternate">
<div><span>Device B</span></div>
<code>$> infinit-user&nbsp;&#8209;&#8209;import&nbsp;&#8209;&#8209;input alice.user
Imported user "alice".
</code>
</pre>

<h2 id="drive">Drive</h2>
<p>Once you’ve created a storage infrastructure with a user, a network, storage resources and volumes, it may be time to invite other users, potentially non-tech-savvy, to use it to seamlessly store and access their files.</p>
<p>A client application called <a href="http://infinit.sh/drive">Infinit Drive</a> is provided for end-users to see the drives they are allowed to access, the people contributing to it, their permissions etc.</p>
<p><img src="${url('images/desktop-client.png')}" alt="Infinit Drive app"></p>
<p>Unfortunately, the notions of storage resource, network and volume are too technical for them to understand. Likewise, such users would probably like to receive a nice email explaining them how to set up and have things simplified for them.</p>
<p>This is why the notion of drive has been introduced. A drive is nothing more than an abstraction on top of a volume.</p>
<p>Rather than listing the networks and volumes a user is allowed to access in the graphical interface, only the drives the user has accepted to join will be shown. This way, should an administrator create a storage network with hundreds of volumes and a single one being abstracted as a drive, the end-user will only see this drive, making his/her experience as enjoyable as possible without limiting the possibilities of the underlying command-line tools.</p>
<h3 id="create-a-drive">Create a drive</h3>
<p>Creating a drive is as easy as any other operation. The following creates a drive named "workspace" based on the network "cluster" and volume "shared".</p>
<pre><code>$&gt; infinit-drive&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;network cluster&nbsp;&#8209;&#8209;volume shared&nbsp;&#8209;&#8209;name workspace&nbsp;&#8209;&#8209;description "Alice’s, Bob’s and Charlie’s workspace"&nbsp;&#8209;&#8209;push
Locally created drive "alice/workspace".
Remotely pushed drive "alice/workspace".
</code></pre><p>Note that the <code>&#8209;&#8209;push</code> option is provided to publish it to the hub, making it retrievable by the other users, in particular the ones that we will be <a href="#invite-users">inviting</a> to join.</p>
<h3 id="list-the-drives">List the drives</h3>
<p>As for the other resources, one can very simply list the local drives. Note that refreshing the local snapshots can be achieved through the <code>&#8209;&#8209;fetch</code> action:</p>
<pre><code>$&gt; infinit-drive&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice
Fetched drives for user "alice".
$&gt; infinit-drive&nbsp;&#8209;&#8209;list
alice/workspace
</code></pre><h3 id="invite-users">Invite users</h3>
<p>It is now time to invite non-tech-savvy users to join the drive you’ve created for them.</p>
<p>Note that before you can reference a user, you need to fetch his/her public identity through the <code>infinit-user&nbsp;&#8209;&#8209;fetch</code> command line. Likewise, every user to invite must have been issued a passport to connect to the network.</p>
<p>The sequence of commands below shows how to invite both Bob and Charlie. However it is assumed that Bob has already been issued a passport while Charlie is a completely new user, hence needs a passport.</p>
<pre><code>$&gt; infinit-user&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name charlie
Fetched user "charlie".
$&gt; infinit-passport&nbsp;&#8209;&#8209;create&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;user charlie&nbsp;&#8209;&#8209;network cluster&nbsp;&#8209;&#8209;push
Locally created passport "alice/cluster: charlie".
Remotely pushed passport "alice/cluster: charlie".
$&gt; infinit-drive&nbsp;&#8209;&#8209;invite&nbsp;&#8209;&#8209;as alice&nbsp;&#8209;&#8209;name workspace&nbsp;&#8209;&#8209;user bob&nbsp;&#8209;&#8209;user charlie&nbsp;&#8209;&#8209;push
Locally created invitations "alice/workspace".
Remotely pushed invitations "alice/workspace".
</code></pre><p>That’s it, Bob and Charlie have been invited to join the drive named "alice/workspace". Following the <code>&#8209;&#8209;push</code> of the invitations, an email will be sent to notify them of such an invitation, letting them know how to proceed.</p>
<h3 id="join-a-drive">Join a drive</h3>
<p>Even though the drive abstraction has been introduced for users with the graphical interface, you can decide to join a drive through the command-line tools.</p>
<p>First, think about refreshing your local snapshots by fetching the drives you’ve been invited to and already have access to. You can then list the drives you have locally:</p>
<pre><code>$&gt; infinit-drive&nbsp;&#8209;&#8209;fetch&nbsp;&#8209;&#8209;as charlie
Fetched drive for user "charlie"
$&gt; infinit-drive&nbsp;&#8209;&#8209;list&nbsp;&#8209;&#8209;as charlie
alice/workspace
</code></pre><p>Finally, you can join a drive through the following command:</p>
<pre><code>$&gt; infinit-drive&nbsp;&#8209;&#8209;join&nbsp;&#8209;&#8209;as charlie&nbsp;&#8209;&#8209;name alice/workspace
Remotely pushed invitation "alice/workspace".
</code></pre><p>That’s it, you are now allowed to mount the volume (i.e &#39;alice/shared&#39;) associated with the drive to browse, store and access files. Note that you could have done that without going through the drive invitation process because you are using the command-line tools. Non-tech-savvy users however will appreciate having an interface clean of everything but the drives they have been invited to join.</p>
